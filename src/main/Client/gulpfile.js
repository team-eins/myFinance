// ********************************************************************************************************************
// * Modules
// ********************************************************************************************************************

var gulp = require('gulp');
var clean = require('gulp-dest-clean');
var del = require('del');
var webpack = require('webpack-stream');

var path = {
    src: 'app/',
    dest: '../webapp/',
};

// ********************************************************************************************************************
// * Html Task
// ********************************************************************************************************************
gulp.task('html', ['clean'], function() {
    gulp.src(path.src + '**/*.html')
        .pipe(gulp.dest(path.dest));
});

// ********************************************************************************************************************
// * Styles Task
// ********************************************************************************************************************
gulp.task('styles', ['clean'], function(){
    gulp.src(path.src + 'styles/**/*.css')
        .pipe(gulp.dest(path.dest + 'styles/'))
});

// ********************************************************************************************************************
// * Scripts Task
// ********************************************************************************************************************
gulp.task('scripts', ['clean'], function () {
    gulp.src(path.src + 'scripts/boot.ts')
        .pipe(webpack(require('./webpack.config.js')))
        .pipe(gulp.dest(path.dest + 'scripts/'));

    gulp.src(path.src + 'scripts/vendor/**/*.js')
        .pipe(gulp.dest(path.dest + 'scripts/vendor/'));
});


// ********************************************************************************************************************
// * Clean Task
// ********************************************************************************************************************
gulp.task('clean', function(){

    return gulp.src('').pipe(clean(path.dest,[path.dest + 'WEB-INF/**', path.dest + 'META-INF/**'], {force:true, verbose: true}));
    //return del.sync([path.dest + '**/*.html', path.dest + '**/*.css', path.dest + '**/*.js'], {force: true});
    //!path.dest, !path.dest + 'META-INF/',
});

// ********************************************************************************************************************
// * Build Task
// ********************************************************************************************************************
gulp.task('build', ['html', 'styles', 'scripts']);

// ********************************************************************************************************************
// * Watch Task
// ********************************************************************************************************************
gulp.task('watch', function () {
    gulp.watch(path.src + '**/*.html', ['html']);
});

// ********************************************************************************************************************
// * Default Task
// ********************************************************************************************************************
gulp.task('default', ['build']);
